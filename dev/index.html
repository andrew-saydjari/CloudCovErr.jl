<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>disCovErr.jl Documentation · disCovErr</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>disCovErr</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>disCovErr.jl Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>disCovErr.jl Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>disCovErr.jl Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="disCovErr.jl-Documentation"><a class="docs-heading-anchor" href="#disCovErr.jl-Documentation">disCovErr.jl Documentation</a><a id="disCovErr.jl-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#disCovErr.jl-Documentation" title="Permalink"></a></h1><ul><li><a href="#disCovErr.jl-Documentation">disCovErr.jl Documentation</a></li></ul><article class="docstring"><header><a class="docstring-binding" id="disCovErr.add_sky_noise!-NTuple{4, Any}" href="#disCovErr.add_sky_noise!-NTuple{4, Any}"><code>disCovErr.add_sky_noise!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">add_sky_noise!(testim2,maskim0,skyim3,gain;seed=2021)</code></pre><p>Adds noise to the infill that matches the Poisson noise of a rough estimate for the sky background. A random seed to set a local random generator is provided for reproducible unit testing.</p><p><strong>Arguments:</strong></p><ul><li><code>testim2</code>: input image which had infilling</li><li><code>maskim0</code>: mask of pixels which were infilled</li><li><code>skyim3</code>: rough estimate of sky background counts</li><li><code>gain</code>: gain of detector to convert from photon count noise to detector noise</li><li><code>seed</code>: random seed for random generator</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/decam.jl#L177-L190">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.boxsmoothMod!-Tuple{Any, Any, Int64, Int64, Int64, Int64}" href="#disCovErr.boxsmoothMod!-Tuple{Any, Any, Int64, Int64, Int64, Int64}"><code>disCovErr.boxsmoothMod!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">boxsmoothMod!(out, arr, widx::Int, widy::Int, sx::Int, sy::Int)</code></pre><p>Boxcar smooths an input image (or paddedview) <code>arr</code> with window size <code>widx</code> by <code>widy</code>. We pass the original image size <code>sx</code> and <code>sy</code> to help handle image views.</p><p><strong>Arguments:</strong></p><ul><li><code>out</code>: preallocated output array for the boxcar smoothed image</li><li><code>arr</code>: input array for which boxcar smoothing is computed (generally paddedview)</li><li><code>widx::Int</code>: size of boxcar smoothing window in x</li><li><code>widy::Int</code>: size of boxcar smoothing window in y</li><li><code>sx::Int</code>: x size of the original (unpadded) image</li><li><code>sy::Int</code>: y size of the original (unpadded) image</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/utils.jl#L99-L112">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.condCovEst_wdiag-NTuple{8, Any}" href="#disCovErr.condCovEst_wdiag-NTuple{8, Any}"><code>disCovErr.condCovEst_wdiag</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">condCovEst_wdiag(cov_loc,μ,k,kstar,kpsf2d,data_in,data_w,stars_in) -&gt; [std_w std_wdiag var_wdb resid_mean pred_mean chi20]</code></pre><p>Using a local covariance matrix estimate <code>cov_loc</code> and a set of known pixels <code>k</code> and unknown pixels <code>kstar</code>, this function computes a prediction for the mean value of the <code>kstar</code> pixels and the covariance matrix of the <code>kstar</code> pixels. In terms of statistics use to adjust the photometry of a star, we are only interested in the pixels masked as a result of the star (i.e. not a detector defect or cosmic ray nearby) which is <code>kpsf2d</code>. The residual image <code>data_in</code>, the weight image <code>data_w</code>, and a model of the counts above the background coming from the star <code>stars_in</code> for the local patch are also inputs of the function. Correction factors for the photometric flux and flux uncertainities are outputs as well as the chi2 value for the predicted pixels.</p><p><strong>Arguments:</strong></p><ul><li><code>cov_loc</code>: local covariance matrix</li><li><code>μ</code>: vector containing mean value for each pixel in the patch</li><li><code>k</code>: unmasked pixels</li><li><code>kstar</code>: masked pixels</li><li><code>kpsf2d</code>: pixels masked due to the star of interest</li><li><code>data_in</code>: residual image in local patch</li><li><code>data_w</code>: weight image in local patch</li><li><code>stars_in</code>: image of counts from star alone in local patch</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/decam.jl#L319-L341">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.cov_construct-Tuple{Any, Any, Any}" href="#disCovErr.cov_construct-Tuple{Any, Any, Any}"><code>disCovErr.cov_construct</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">cov_construct(img, cx, cy; Np::Int=33, widx::Int=129, widy::Int=129) -&gt; cov, μ</code></pre><p>Construct a local covariance matrix estimate from <code>img</code> centered around pixel <code>cx</code> and <code>cy</code>. The covariance matrix will be for a square subimage of size <code>Np</code> by <code>Np</code> pixels, yielding <code>cov</code> of size <code>Np</code>^2. The covariance matrix is estimated by taking samples over pixels within a box of size <code>widx</code> and <code>widy</code> centered on the pixel of interest.</p><p>If <code>cx</code> and <code>cy</code> are arrays, the first index of the returned <code>cov</code> will be the index of the center point and <code>μ</code> will be the same length as <code>cx</code>.</p><p>In the interest of speed for the case of wanting to construct the covariance matrix at many posiitons, the moving mean of the full input image (times shifts of the input image) is precomputed for every entry of the covariance matrix. This may not be efficient for few <code>cx</code>.</p><p>Note that the values of <code>widx</code> and <code>widy</code> determine how local an estimate the covariance matrix returned is, but for too small of values of <code>widx</code> and <code>widy</code>, the covariance matrix estimate may be singular (one should always keep <code>Np</code>^2 &lt; <code>widx</code>*<code>widy</code>).</p><p><strong>Arguments:</strong></p><ul><li><code>img</code>: Input image for which we desire the covariance matrix estimate</li><li><code>cx</code>: x position (or positions) at which we want a covariance matrix estimate</li><li><code>cy</code>: y position (or positions) at which we want a covariance matrix estimate</li><li><code>Np</code>: size of the image stamp for which the covariance matrix will be estimated</li><li><code>widx</code>: size of sampled region in x used to estimate entries in the covariance matrix</li><li><code>widy</code>: size of sampled region in y used to estimate the entries in the covariance matrix</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/utils.jl#L7-L34">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.gen_mask_staticPSF!" href="#disCovErr.gen_mask_staticPSF!"><code>disCovErr.gen_mask_staticPSF!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">gen_mask_staticPSF!(maskd, psfstamp, x_stars, y_stars, flux_stars, thr=20)</code></pre><p>Generate a mask for an input image (which is usually an image of model residuals) that excludes the cores of stars (which are often mismodeled). In this function, we use a fixed PSF <code>psfstamp</code> for all sources, and adjust the masking fraction based on the stellar flux and a threshold <code>thr</code>. A more general position dependent PSF model could be used with a slight generalization of this function, but is likely overkill for the problem of making a mask.</p><p><strong>Arguments:</strong></p><ul><li><code>maskd</code>: bool image to which mask will be added (bitwise or)</li><li><code>psfstamp</code>: simple 2D array of a single PSF to be used for the whole image</li><li><code>x_stars</code>: list of source x positions</li><li><code>y_stars</code>: list of source y positions</li><li><code>flux_stars</code>: list of source fluxes</li><li><code>thr</code>: threshold used for flux-dependent masking</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/decam.jl#L77-L94">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.prelim_infill!-NTuple{7, Any}" href="#disCovErr.prelim_infill!-NTuple{7, Any}"><code>disCovErr.prelim_infill!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">prelim_infill!(testim,maskim,bimage,bimageI,testim2, maskim2, goodpix; widx = 19, widy=19)</code></pre><p>This intial infill replaces masked pixels with a guess based on a smoothed boxcar. For large masked regions, the smoothing scale is increased. If this iteration takes too long/requires too strong of masking, the masked pixels are replaced with the median of the image.</p><p>We use 3 copies of the input image and mask image. The first is an untouched view (with reflective boundary condition padding), the second is allocated to hold various smoothings of the image, and the third holds the output image which contains our best infill guess. A final bool array of size corresponding to the image is used to keep track of pixels that have safe infill values.</p><p><strong>Arguments:</strong></p><ul><li><code>testim</code>: input image which requires infilling</li><li><code>bimage</code>: preallocated array for smoothed version of input image</li><li><code>testim2</code>: inplace modified ouptut array for infilled version of image input</li><li><code>maskim</code>: input mask indicating which pixels require infilling</li><li><code>bimageI</code>: preallocated array for smoothed mask counting the samples for each estimate</li><li><code>maskim2</code>: inplace modified mask to keep track of which pixels still need infilling</li><li><code>widx::Int</code>: size of boxcar smoothing window in x</li><li><code>widy::Int</code>: size of boxcar smoothing window in y</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/decam.jl#L111-L135">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.read_crowdsource-NTuple{5, Any}" href="#disCovErr.read_crowdsource-NTuple{5, Any}"><code>disCovErr.read_crowdsource</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">read_crowdsource(base,date,filt,vers,ccd) -&gt; x_stars, y_stars, decapsid, gain, mod_im, sky_im</code></pre><p>Read in outputs of crowdsource, a photometric pipeline. To pair with an arbitrary photometric pipeline, an analogous read in function should be created. The relevant outputs are the model image (including the sources) so that we can produce the residual image, the sky/background model (no sources), and the coordinates of the stars. The survey id number is also readout of the pipeline solution file to help cross-validate matching of the disCovErr outputs and the original sources. The emperical gain is read out of the header (for other photometric pipelines which don&#39;t perform this estiamte, the gain from DECam is likely sufficient).</p><p><strong>Arguments:</strong></p><ul><li><code>base</code>: parent directory and file name prefix for crowdsource results files</li><li><code>date</code>: date_time of the exposure</li><li><code>filt</code>: optical filter used to take the exposure</li><li><code>vers</code>: NOAO community processing version number</li><li><code>ccd</code>: which ccd we are pulling the image for</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/decam.jl#L43-L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="disCovErr.read_decam-NTuple{5, Any}" href="#disCovErr.read_decam-NTuple{5, Any}"><code>disCovErr.read_decam</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">read_decam(base,date,filt,vers,ccd) -&gt; ref_im, w_im, d_im</code></pre><p>Read in raw image files associated with exposures obtain on the DarkEnergyCamera. Returns the image, a weighting image, and a quality flag mask image. See <a href="http://ast.noao.edu/sites/default/files/NOAO_DHB_v2.2.pdf">NOAO handbook</a> for more details on what is contained in each file and how they are obtained.</p><p><strong>Arguments:</strong></p><ul><li><code>base</code>: parent directory and file name prefix for exposure files</li><li><code>date</code>: date_time of the exposure</li><li><code>filt</code>: optical filter used to take the exposure</li><li><code>vers</code>: NOAO community processing version number</li><li><code>ccd</code>: which ccd we are pulling the image for</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">ref_im, w_im, d_im = read_decam(&quot;/n/fink2/decaps/c4d_&quot;,&quot;170420_040428&quot;,&quot;g&quot;,&quot;v1&quot;,&quot;N14&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/disCovErr.jl/blob/7c0800d5a231f2f3b34f11ce0cd78cf78d42ea58/src/decam.jl#L9-L29">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.8 on <span class="colophon-date" title="Friday 15 October 2021 02:27">Friday 15 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
